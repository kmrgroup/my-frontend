(function(){"use strict";let a=!1,t=1,n="balanced",i=Date.now(),s=0;function d(){try{return console.log("Mining worker initialized"),self.postMessage({type:"initialized"}),!0}catch(r){const o=r instanceof Error?r.message:"Failed to initialize mining worker";return console.error("Mining worker initialization error:",o),self.postMessage({type:"error",data:{error:o}}),!1}}function u(){const r=Date.now(),o=(r-i)/1e3,e=s/o;return s=0,i=r,e}function m(r){const e=Math.pow(1.5,r),l=p(u()),f=g();return 1e-5*e*l*f}function p(r){return Math.min(1.5,1+r/1e3*.1)}function g(){const r=(Date.now()-h)/36e5;return Math.min(1.2,1+r*.01)}function w(){return crypto.randomUUID()}async function c(){if(a)try{const r=Date.now(),o=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),e=w();if(s++,Math.random()<1/(t*10)){const y=m(t);self.postMessage({type:"reward",data:{amount:y.toString(),hash:e,metrics:{accuracy:"0.85",loss:"0.15"},difficulty:t.toString()}})}Date.now()-i>=1e3&&self.postMessage({type:"hash",data:{hashRate:u()}});const l={efficient:2,balanced:1,performance:.5}[n]||1,f=Math.max(10,Math.min(50,t*10*l));setTimeout(c,f)}catch(r){const o=r instanceof Error?r.message:"Unknown mining error";console.error("Mining error:",o),self.postMessage({type:"error",data:{error:o}}),setTimeout(()=>{a&&c()},5e3)}}const h=Date.now();d(),self.onmessage=r=>{try{if(!r.data||typeof r.data!="object")throw new Error("Invalid message format");const{type:o,data:e}=r.data;if(!o||typeof o!="string")throw new Error("Missing or invalid command type");switch(o){case"start":a=!0,e!=null&&e.config&&(n=e.config.powerMode||"balanced"),console.log("Starting mining with power mode:",n),c();break;case"pause":a=!1,console.log("Mining paused");break;case"setDifficulty":e&&typeof e.difficulty=="number"&&!isNaN(e.difficulty)?(t=Math.max(1,e.difficulty),console.log("Difficulty updated:",t)):console.warn("Invalid difficulty value:",e==null?void 0:e.difficulty);break;case"setPowerMode":e!=null&&e.mode&&["efficient","balanced","performance"].includes(e.mode)?(n=e.mode,console.log("Power mode updated:",n)):console.warn("Invalid power mode:",e==null?void 0:e.mode);break;default:throw new Error(`Unknown command type: ${o}`)}}catch(o){console.error("Error handling worker message:",o),self.postMessage({type:"error",data:{error:o instanceof Error?o.message:"Failed to process mining command"}})}},self.onerror=r=>{console.error("Worker error:",r),self.postMessage({type:"error",data:{error:"Mining worker encountered a critical error"}})}})();
